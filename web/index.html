<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sentiment Analysis — Simple Tester</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root{
      --bg:#0f1220; --card:#171a2b; --muted:#aab1d1; --text:#e9ecff;
      --accent:#6ea8fe; --good:#4cc38a; --bad:#ef5f6b; --warn:#ffcc66;
      --border:#2a2f45; --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:16px;
    }
    html,body{height:100%}
    *{box-sizing:border-box}
    body{
      margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      background:radial-gradient(1200px 800px at 80% -10%, #1b1f36 0%, #0f1220 60%);
      color:var(--text);
    }
    .wrap{
      max-width:1100px; margin:40px auto; padding:0 16px;
      display:grid; grid-template-columns:1.2fr .8fr; gap:20px;
    }
    .title{
      grid-column:1/-1; display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .title h1{margin:0; font-size:26px; letter-spacing:.2px}
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
      border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow);
    }
    .card .hd{
      padding:16px 18px; border-bottom:1px solid var(--border); color:var(--muted); font-weight:600; letter-spacing:.3px;
    }
    .card .bd{padding:16px 18px}
    label{display:block; font-size:13px; color:var(--muted); margin:6px 0 8px}
    input[type=text], textarea{
      width:100%; background:#0c0f1c; border:1px solid var(--border);
      color:var(--text); border-radius:12px; padding:12px 14px; outline:none;
      transition:border .2s, box-shadow .2s; font-size:14px;
    }
    input[type=text]:focus, textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(110,168,254,.15)}
    textarea{min-height:160px; resize:vertical; line-height:1.5}
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      appearance:none; border:1px solid var(--border); background:#12162a; color:var(--text);
      padding:11px 14px; border-radius:12px; cursor:pointer; font-weight:600; letter-spacing:.2px;
      transition:transform .05s ease, border-color .2s, background .2s;
    }
    .btn:hover{border-color:var(--accent)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(180deg, #1b4cff, #1439c7); border-color:#2346d9}
    .btn.ghost{background:transparent}
    .muted{color:var(--muted); font-size:13px}
    .status{
      display:flex; align-items:center; gap:10px; padding:10px 12px; border-radius:12px; background:#0c0f1c; border:1px solid var(--border);
      font-size:13px; color:var(--muted);
    }
    .pill{display:inline-flex; align-items:center; gap:8px; padding:8px 10px; border-radius:999px; border:1px solid var(--border); background:#0c0f1c; color:var(--muted); font-size:12px}
    .tag{display:inline-block; padding:6px 10px; border-radius:999px; font-weight:700; letter-spacing:.3px; font-size:12px}
    .tag.good{background:rgba(76,195,138,.1); color:var(--good); border:1px solid rgba(76,195,138,.25)}
    .tag.bad{background:rgba(239,95,107,.1); color:var(--bad); border:1px solid rgba(239,95,107,.25)}
    .tag.warn{background:rgba(255,204,102,.1); color:var(--warn); border:1px solid rgba(255,204,102,.25)}
    .result{
      display:grid; grid-template-columns:1fr auto; gap:10px; align-items:center;
      padding:12px 14px; border-radius:12px; background:#0c0f1c; border:1px solid var(--border);
    }
    .meter{
      height:10px; width:100%; background:#0b0e19; border:1px solid var(--border); border-radius:999px; overflow:hidden;
    }
    .bar{height:100%; width:0%}
    .bar.pos{background:linear-gradient(90deg, #2fb47c, #4cc38a)}
    .bar.neg{background:linear-gradient(90deg, #e05767, #ef5f6b)}
    .hist{display:flex; flex-direction:column; gap:10px}
    .hist-item{
      padding:12px; border:1px solid var(--border); border-radius:12px; background:#101426;
      display:grid; grid-template-columns:auto 1fr auto; gap:10px; align-items:center;
    }
    .hist-item .txt{color:var(--muted); font-size:13px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; max-width:340px}
    .small{font-size:12px; color:var(--muted)}
    .footer{grid-column:1/-1; text-align:center; color:var(--muted); font-size:12px; padding:14px 0 30px}
    @media (max-width: 900px){
      .wrap{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="title">
      <h1>Sentiment Analysis Tester</h1>
      <div class="pill">
        <span>API status:</span>
        <strong id="apiStatus">unknown</strong>
      </div>
    </div>

    <!-- Left: Tester -->
    <section class="card">
      <div class="hd">Request</div>
      <div class="bd">
        <label for="apiUrl">API URL</label>
        <input id="apiUrl" type="text" placeholder="http://localhost:8000/predict" value="http://localhost:8000/predict" />

        <label for="text">Text</label>
        <textarea id="text" placeholder="Type something to analyze...">I absolutely love this project!</textarea>

        <div class="row" style="margin-top:10px">
          <button class="btn primary" id="analyzeBtn">Analyze</button>
          <button class="btn ghost" id="checkBtn" title="Ping /health">Check API</button>
          <span class="muted" id="hint">Tip: start your FastAPI server first.</span>
        </div>

        <div class="status" id="status" style="margin-top:12px; display:none"></div>
      </div>
    </section>

    <!-- Right: Result -->
    <section class="card">
      <div class="hd">Result</div>
      <div class="bd" id="resultBox">
        <div class="result" style="margin-bottom:10px">
          <div>
            <div class="small">Label</div>
            <div id="label" class="tag warn">Waiting…</div>
          </div>
          <div style="min-width:220px">
            <div class="small" style="margin-bottom:6px">Confidence</div>
            <div class="meter"><div id="bar" class="bar" style="width:0%"></div></div>
          </div>
        </div>
        <div class="small">Raw response</div>
        <pre id="raw" style="background:#0c0f1c; border:1px solid var(--border); padding:12px; border-radius:12px; overflow:auto; max-height:220px; margin-top:6px; color:#d7dcff"></pre>
      </div>
    </section>

    <!-- History -->
    <section class="card" style="grid-column:1/-1">
      <div class="hd">History</div>
      <div class="bd">
        <div class="hist" id="history"></div>
      </div>
    </section>

    <div class="footer">Frontend: HTML + CSS (vanilla). Works with your FastAPI sentiment endpoint at <code>/predict</code>.</div>
  </div>

  <!-- <script>
    // Minimal JS to wire the UI to your FastAPI endpoint
    const apiUrlEl = document.getElementById('apiUrl');
    const textEl = document.getElementById('text');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const checkBtn = document.getElementById('checkBtn');
    const statusEl = document.getElementById('status');
    const apiStatusEl = document.getElementById('apiStatus');
    const labelEl = document.getElementById('label');
    const barEl = document.getElementById('bar');
    const rawEl = document.getElementById('raw');
    const historyEl = document.getElementById('history');

    function setStatus(msg, ok=true){
      statusEl.style.display = 'flex';
      statusEl.style.borderColor = ok ? 'rgba(76,195,138,.35)' : 'rgba(239,95,107,.35)';
      statusEl.innerText = msg;
    }
    function setAPIStatus(txt, color){
      apiStatusEl.textContent = txt;
      apiStatusEl.style.color = color;
    }

    async function ping(){
      const url = apiUrlEl.value.replace(/\/predict\s*$/,'/health');
      try{
        const r = await fetch(url,{method:'GET'});
        if(!r.ok) throw new Error(r.status);
        const j = await r.json();
        setAPIStatus('online', '#4cc38a');
        setStatus('API is reachable: ' + url, true);
      }catch(e){
        setAPIStatus('offline', '#ef5f6b');
        setStatus('API not reachable at ' + url, false);
      }
    }

    function renderResult(data){
      // Supports either: {label, score} or {prediction, probabilities}
      let label = data.label || data.prediction || 'N/A';
      let score = data.score;
      if(score == null){
        const probs = data.probabilities || {};
        score = Math.max(...Object.values(probs || {0:0}));
      }
      score = Math.round((score||0)*100);

      labelEl.textContent = label;
      labelEl.className = 'tag ' + (label.toLowerCase().includes('pos') ? 'good'
                      : label.toLowerCase().includes('neg') ? 'bad' : 'warn');
      barEl.style.width = score + '%';
      barEl.className = 'bar ' + (label.toLowerCase().includes('pos') ? 'pos'
                        : label.toLowerCase().includes('neg') ? 'neg' : '');
      rawEl.textContent = JSON.stringify(data, null, 2);
    }

    function pushHistory(input, data){
      const div = document.createElement('div');
      div.className = 'hist-item';
      const tag = document.createElement('span');
      const label = (data.label||data.prediction||'').toString().toUpperCase();
      tag.className = 'tag ' + (label.includes('POS') ? 'good' : label.includes('NEG') ? 'bad' : 'warn');
      tag.textContent = label || 'RESULT';
      const txt = document.createElement('div');
      txt.className = 'txt';
      txt.title = input;
      txt.textContent = input;
      const conf = document.createElement('div');
      conf.className = 'small';
      const score = data.score != null ? data.score : Math.max(...Object.values(data.probabilities||{0:0}));
      conf.textContent = 'score ' + (typeof score === 'number' ? (Math.round(score*100)/100) : score);
      div.append(tag, txt, conf);
      historyEl.prepend(div);
    }

    analyzeBtn.addEventListener('click', async ()=>{
      const url = apiUrlEl.value.trim();
      const text = textEl.value.trim();
      if(!url || !text){ setStatus('Enter API URL and some text', false); return; }
      setStatus('Sending request…', true);
      try{
        const r = await fetch(url, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ text })
        });
        const j = await r.json();
        renderResult(j);
        pushHistory(text, j);
        setStatus('Success', true);
      }catch(e){
        setStatus('Request failed. Check CORS and server logs.', false);
      }
    });

    checkBtn.addEventListener('click', ping);

    // Initial ping after load
    setTimeout(ping, 400);
  </script> -->
  <script>
  // ---------- UI handles ----------
  const apiUrlEl   = document.getElementById('apiUrl');
  const textEl     = document.getElementById('text');
  const analyzeBtn = document.getElementById('analyzeBtn');
  const checkBtn   = document.getElementById('checkBtn');
  const statusEl   = document.getElementById('status');
  const apiStatusEl= document.getElementById('apiStatus');
  const labelEl    = document.getElementById('label');
  const barEl      = document.getElementById('bar');
  const rawEl      = document.getElementById('raw');
  const historyEl  = document.getElementById('history');

  // ---------- helpers ----------
  function setStatus(msg, ok=true){
    statusEl.style.display = 'flex';
    statusEl.style.borderColor = ok ? 'rgba(76,195,138,.35)' : 'rgba(239,95,107,.35)';
    statusEl.textContent = msg;
  }
  function setAPIStatus(txt, color){
    apiStatusEl.textContent = txt;
    apiStatusEl.style.color = color;
  }

  function renderResult(data){
    let label = data.label || data.prediction || 'N/A';
    let score = data.score;
    if (score == null){
      const probs = data.probabilities || {};
      score = Math.max(...Object.values(probs || {0:0}));
    }
    score = Math.round((score||0)*100);

    labelEl.textContent = label;
    labelEl.className = 'tag ' + (label.toLowerCase().includes('pos') ? 'good'
                      : label.toLowerCase().includes('neg') ? 'bad' : 'warn');
    barEl.style.width = score + '%';
    barEl.className = 'bar ' + (label.toLowerCase().includes('pos') ? 'pos'
                      : label.toLowerCase().includes('neg') ? 'neg' : '');
    rawEl.textContent = JSON.stringify(data, null, 2);
  }

  function pushHistory(input, data){
    const div = document.createElement('div');
    div.className = 'hist-item';
    const tag = document.createElement('span');
    const label = (data.label||data.prediction||'').toString().toUpperCase();
    tag.className = 'tag ' + (label.includes('POS') ? 'good' : label.includes('NEG') ? 'bad' : 'warn');
    tag.textContent = label || 'RESULT';
    const txt = document.createElement('div');
    txt.className = 'txt'; txt.title = input; txt.textContent = input;
    const conf = document.createElement('div');
    conf.className = 'small';
    const score = data.score != null ? data.score : Math.max(...Object.values(data.probabilities||{0:0}));
    conf.textContent = 'score ' + (typeof score === 'number' ? (Math.round(score*100)/100) : score);
    div.append(tag, txt, conf);
    historyEl.prepend(div);
  }

  // ---------- auto-detect API ----------
  async function probe(url){
    try{
      const health = url.replace(/\/predict\s*$/,'/health');
      const r = await fetch(health, { method:'GET' });
      if (!r.ok) throw new Error(r.status);
      await r.json(); // must be json
      return true;
    }catch(e){ return false; }
  }

  async function autoDetectAPI(){
    // Priority: ?api= override > saved > same-origin /predict > /api/predict > localhost:8000/predict
    const params = new URLSearchParams(location.search);
    const override = params.get('api');
    const saved = localStorage.getItem('API_URL');

    const sameOrigin = location.origin;
    const candidates = [
      override,
      saved,
      `${sameOrigin}/predict`,
      `${sameOrigin}/api/predict`,
      `http://localhost:8000/predict`
    ].filter(Boolean);

    for (const c of candidates){
      if (await probe(c)){
        apiUrlEl.value = c;
        localStorage.setItem('API_URL', c);
        setAPIStatus('online', '#4cc38a');
        setStatus(`Using API: ${c}`, true);
        // optional: hide the field once auto-detected
        apiUrlEl.readOnly = true;
        apiUrlEl.style.opacity = 0.7;
        return c;
      }
    }
    // nothing worked
    setAPIStatus('offline', '#ef5f6b');
    setStatus('Could not auto-detect API. Start your server or pass ?api= URL.', false);
    // leave a sensible default for user
    apiUrlEl.value = saved || `http://localhost:8000/predict`;
    return null;
  }

  async function ping(){
    const ok = await probe(apiUrlEl.value);
    if (ok){
      setAPIStatus('online', '#4cc38a');
      setStatus('API is reachable.', true);
    } else {
      setAPIStatus('offline', '#ef5f6b');
      setStatus('API not reachable at ' + apiUrlEl.value, false);
    }
  }

  analyzeBtn.addEventListener('click', async ()=>{
    const url = apiUrlEl.value.trim();
    const text = textEl.value.trim();
    if(!url || !text){ setStatus('Enter API URL and some text', false); return; }
    setStatus('Sending request…', true);
    try{
      const r = await fetch(url, {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({ text })
      });
      const j = await r.json();
      renderResult(j);
      pushHistory(text, j);
      setStatus('Success', true);
    }catch(e){
      setStatus('Request failed. Check CORS and server logs.', false);
    }
  });

  checkBtn.addEventListener('click', ping);

  // Kick off auto-detection after load
  window.addEventListener('load', autoDetectAPI);
</script>
</body>
</html>
